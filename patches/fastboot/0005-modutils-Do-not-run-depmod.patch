From 92480918ead5a2df3071efee81650139f4ad4d0f Mon Sep 17 00:00:00 2001
From: Klaus Kurzmann <mok@fluxnetz.de>
Date: Sat, 13 Dec 2008 10:39:59 +0100
Subject: [PATCH] modutils: Do not run depmod.

Author: Chia-I Wu <olv@openmoko.com>
Signed-off-by: Klaus Kurzmann <mok@fluxnetz.de>
---
 packages/modutils/files/openmoko/modutils.sh |   21 +++++++++++++++++++++
 packages/modutils/modutils-initscripts.bb    |    2 +-
 2 files changed, 22 insertions(+), 1 deletions(-)
 create mode 100644 packages/modutils/files/openmoko/modutils.sh

diff --git a/packages/modutils/files/openmoko/modutils.sh b/packages/modutils/files/openmoko/modutils.sh
new file mode 100644
index 0000000..06601ce
--- /dev/null
+++ b/packages/modutils/files/openmoko/modutils.sh
@@ -0,0 +1,21 @@
+#!/bin/sh
+
+LOAD_MODULE=modprobe
+[ -e /sbin/modprobe ] || LOAD_MODULE=insmod
+
+if [ -f /proc/modules ]; then
+	if [ -f /etc/modules ]; then
+		[ "$VERBOSE" != no ] && echo -n "Loading modules: "
+		while read module args
+		do
+			case "$module" in
+				\#*|"") continue ;;
+			esac
+			[ "$VERBOSE" != no ] && echo -n "$module "
+			eval "$LOAD_MODULE $module $args >/dev/null 2>&1"
+		done < /etc/modules
+		[ "$VERBOSE" != no ] && echo
+	fi
+fi
+
+: exit 0
diff --git a/packages/modutils/modutils-initscripts.bb b/packages/modutils/modutils-initscripts.bb
index bf51ca8..8b93920 100644
--- a/packages/modutils/modutils-initscripts.bb
+++ b/packages/modutils/modutils-initscripts.bb
@@ -2,7 +2,7 @@ SECTION = "base"
 DESCRIPTION = "modutils configuration files"
 LICENSE = "PD"
 SRC_URI = "file://modutils.sh"
-PR = "r2"
+PR = "r2.1"
 
 INITSCRIPT_NAME = "modutils.sh"
 INITSCRIPT_PARAMS = "start 20 S ."
-- 
1.6.0.4

